<html>
<head>
    <script src="gpu-browser.min.js"></script>
    <script src="MyLib.js"></script>
    <script src="ins.js"></script>
    <script src="drums.js"></script>
</head>
<body>
    <div id="xy" style="width:100%;height:100%;">
        <div id="ab" style="position:absolute;top:20px;left:20px;font-size:20px;color:white;">HALLO</div>
    </div>
    
<script>
    const gpu = new GPU();
    const tarot = new Tarot("Joke of the day " + new Date());
    const kernel = gpu.createKernel(fractal).setOutput([512,512]).setGraphical(true);
    const cv = kernel.canvas;
    
    document.getElementById("xy").appendChild(cv);
    cv.style.width = "100%";
    cv.style.height = "100%";


    let cfg = [512,512,-5,5,5,-5];
    
    for(let i = 1;i <= 10;++i) {
        cfg.push(0);
        cfg.push(0);
    }
    
    cfg[6] = 0;
    cfg[7] = 0;
    cfg[8] = 0;
    cfg[9] = 0;
    cfg[10] = 1;
    cfg[11] = 0;
    
    cfg[16] = 1;
    cfg[17] = 0;
    
    kernel(cfg);
    
    window.setInterval(() => {
        for(let i = 1;i <= 5;++i) {
            cfg[6 + 2 * i] += 0.002 * i * (Math.random() - 0.5);
            cfg[6 + 2 * i + 1] += 0.002 * i * (Math.random() - 0.5);
        }
        kernel(cfg);
    },10);
        
    function speak() {
        var msg = new SpeechSynthesisUtterance();
        msg.text = tarot.get();
        msg.onend = speak;
        document.getElementById("ab").innerText = msg.text;
        window.speechSynthesis.speak(msg);
    }
    
    speak();

    var audioCtx = new (window.AudioContext || window.webkitAudioContext)();


    function sound() {
        // Stereo
        var channels = 2;
        // Create an empty two second stereo buffer at the
        // sample rate of the AudioContext
        var frameCount = audioCtx.sampleRate * 2.0;

        var myArrayBuffer = audioCtx.createBuffer(channels, frameCount, audioCtx.sampleRate);

        button.onclick = function() {
          // Fill the buffer with white noise;
          //just random values between -1.0 and 1.0
          for (var channel = 0; channel < channels; channel++) {
           // This gives us the actual ArrayBuffer that contains the data
           var nowBuffering = myArrayBuffer.getChannelData(channel);
           for (var i = 0; i < frameCount; i++) {
             // Math.random() is in [0; 1.0]
             // audio needs to be in [-1.0; 1.0]
             nowBuffering[i] = Math.random() * 2 - 1;
           }
          }

          // Get an AudioBufferSourceNode.
          // This is the AudioNode to use when we want to play an AudioBuffer
          var source = audioCtx.createBufferSource();
          // set the buffer in the AudioBufferSourceNode
          source.buffer = myArrayBuffer;
          // connect the AudioBufferSourceNode to the
          // destination so we can hear the sound
          source.connect(audioCtx.destination);
          // start the source playing
          source.start();
        }
    }
</script>
</body>
</html>

